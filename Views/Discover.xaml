<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="BouncyCat.Views.Discover"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:BouncyCat"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:tool="using:CommunityToolkit.WinUI.Controls"
    xmlns:animations="using:CommunityToolkit.WinUI.Animations"
    xmlns:obj="using:BouncyCat.Objects"
    xmlns:ic="using:FluentIcons.WinUI"
    xmlns:lab="using:CommunityToolkit.Labs.WinUI"
    xmlns:ry="using:Richasy.WinUIKernel.Share.Base"
    xmlns:vm="using:BouncyCat.ViewModels"
    xmlns:base="using:Richasy.WinUIKernel.Share.Base"
    xmlns:blur="using:BouncyCat.Controls.LinearGradientBlurEffect"
    Background="{ThemeResource DesktopAcrylicTransparentBrush}"
    mc:Ignorable="d">

    <SplitView x:Name="Wrapper" PanePlacement="Right" DisplayMode="Overlay" IsPaneOpen="{x:Bind ViewModel.IsPaneOpen,Mode=TwoWay}"  PaneBackground="Transparent" OpenPaneLength="370">
        <SplitView.Pane>
            <ScrollViewer Margin="15" Background="{ThemeResource AcrylicInAppFillColorDefaultBrush}" CornerRadius="12" Padding="20">
                <StackPanel Orientation="Vertical" Spacing="20">
                    <Grid ColumnSpacing="8" RowSpacing="6">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"></ColumnDefinition>
                            <ColumnDefinition Width="*"></ColumnDefinition>
                            <ColumnDefinition Width="Auto"></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Width="46" Height="46" VerticalAlignment="Center"  BorderThickness="0" CornerRadius="4">
                            <Image Source="/Assets/cyberpunk.png"></Image>
                        </Border>
                        <TextBlock Grid.Row="0" Grid.Column="1" VerticalAlignment="Top" Text="èµ›åšæœ‹å…‹2077" FontWeight="Bold" HorizontalAlignment="Left"></TextBlock>
                        <Border Grid.Row="0" Grid.Column="1"  BorderBrush="Transparent" HorizontalAlignment="Right" Background="Pink" Width="50" Height="24" CornerRadius="4" Opacity="0.4">
                            <TextBlock  Text="AD516" FontSize="11" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0"></TextBlock>
                        </Border>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="Cyberpunk 2077" FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}"></TextBlock>
                        <HyperlinkButton Grid.Row="0" Grid.Column="2" Padding="4">
                            <ic:SymbolIcon Symbol="MoreHorizontal" FontSize="14"></ic:SymbolIcon>
                        </HyperlinkButton>
                    </Grid>
                    <TextBlock  Text="v1.8|å®¹é‡4GB|å®˜æ–¹ç®€ä½“ä¸­æ–‡|2025å¹´08æœˆ08æ—¥æ›´æ–°" FontSize="13" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"></TextBlock>
                    <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Stretch">
                        <Button  Style="{ThemeResource AccentButtonStyle}">
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <ic:SymbolIcon Symbol="Cloud" FontSize="17"></ic:SymbolIcon>
                                <TextBlock Text="é˜¿é‡Œäº‘"></TextBlock>
                            </StackPanel>
                        </Button>
                        <Button  Style="{ThemeResource AccentButtonStyle}">
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <ic:SymbolIcon Symbol="Cloud" FontSize="17"></ic:SymbolIcon>
                                <TextBlock Text="å¤¸å…‹"></TextBlock>
                            </StackPanel>
                        </Button>
                        <Button  Style="{ThemeResource AccentButtonStyle}">
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <ic:SymbolIcon Symbol="ArrowDownload" FontSize="15"></ic:SymbolIcon>
                                <TextBlock Text="åœ¨çº¿æº"></TextBlock>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                    <Grid VerticalAlignment="Stretch" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"  BorderThickness="1" CornerRadius="4" >
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="1"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0"  Text="æ¸¸æˆæˆªå›¾" FontWeight="SemiBold" Margin="15,10,15,10"></TextBlock>
                        <HyperlinkButton Grid.Row="0" HorizontalAlignment="Right" Padding="4" Margin="0,0,5,0">
                            <ic:SymbolIcon Symbol="ChevronRight"></ic:SymbolIcon>
                        </HyperlinkButton>
                        <Border Grid.Row="1" BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" BorderThickness="1"></Border>
                    </Grid> 
                </StackPanel>
            </ScrollViewer>

        </SplitView.Pane>
        <SplitView.Content>
            <Grid x:Name="RootGrid">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" MinHeight="60"></RowDefinition>
                    <RowDefinition Height="12*"></RowDefinition>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" x:Name="LeftColumn"></ColumnDefinition>
                    <ColumnDefinition Width="7*"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                
                <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" VerticalAlignment="Bottom" HorizontalAlignment="Stretch" Height="1" BorderThickness="1" BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"></Border>
                <Border Grid.Row="0" Grid.Column="0" Width="1" HorizontalAlignment="Right" VerticalAlignment="Stretch" Background="{ThemeResource DividerStrokeColorDefaultBrush}">
                    <Border.RenderTransform>
                        <TranslateTransform X="6.5" Y="0"></TranslateTransform>
                    </Border.RenderTransform>
                </Border>
                <TextBlock Grid.Row="0" Grid.Column="0" HorizontalAlignment="Left" VerticalAlignment="Center" Text="æœç´¢ç­›é€‰" FontWeight="Bold" Margin="15,0,0,0" x:Name="Title"></TextBlock>
                <Grid Grid.Row="1" Grid.Column="0" RowSpacing="10" x:Name="SectionArea">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"></RowDefinition>
                        <RowDefinition Height="1"></RowDefinition>
                        <RowDefinition Height="*"></RowDefinition>
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Orientation="Vertical" Spacing="5">
                        <tool:RangeSelector HorizontalAlignment="Stretch" RangeStart="{x:Bind ViewModel.RangeStart,Mode=TwoWay}" RangeEnd="{x:Bind ViewModel.RangeEnd,Mode=TwoWay}" Minimum="0" Maximum="5" StepFrequency="1" Margin="16,10,10,0" ValueChanged="RangeSelector_ValueChanged"></tool:RangeSelector>
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="çƒ­åº¦èŒƒå›´2-4" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"></TextBlock>
                    </StackPanel>
                    <Border Grid.Row="1"  VerticalAlignment="Center" HorizontalAlignment="Stretch" Height="1" BorderThickness="1" BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"></Border>
                    <ScrollViewer Grid.Row="2">
                        <ItemsRepeater  x:Name="SectionList" ItemsSource="{x:Bind ViewModel.Sections}">
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="obj:GameSection">
                                    <HyperlinkButton BorderThickness="0" CornerRadius="0" HorizontalContentAlignment="Stretch" HorizontalAlignment="Stretch">
                                        
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="30"></ColumnDefinition>
                                                <ColumnDefinition Width="*"></ColumnDefinition>
                                                <ColumnDefinition Width="30"></ColumnDefinition>
                                            </Grid.ColumnDefinitions>
                                            <CheckBox Grid.Column="0" IsChecked="{Binding Pinned,Mode=TwoWay}" x:Name="SectionPicker" Checked="SectionPicker_Checked" Unchecked="SectionPicker_Unchecked"></CheckBox>

                                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
                                                <TextBlock VerticalAlignment="Center" Text="{Binding Name,Mode=OneWay}" FontSize="13"></TextBlock>
                                                <TextBlock VerticalAlignment="Center" Text="{Binding Count,Mode=OneWay}" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"></TextBlock>
                                            </StackPanel>
                                            <FontIcon Grid.Column="2" Glyph="&#xF16D;" Foreground="{ThemeResource TextFillColorSecondaryBrush}"></FontIcon>
                                        </Grid>
                                    </HyperlinkButton>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </ScrollViewer>

                </Grid>
                <Grid Grid.Row="0" Grid.Column="1" x:Name="FilterArea">
                    <ComboBox  HorizontalAlignment="Right" VerticalAlignment="Center" Margin="15,0,30,0" PlaceholderText="é»˜è®¤æŽ’åº" SelectedIndex="{x:Bind ViewModel.Order,Mode=TwoWay}" x:Name="OrderController" SelectionChanged="OrderController_SelectionChanged">
                        <ComboBoxItem Content="é»˜è®¤æŽ’åº"></ComboBoxItem>
                        <ComboBoxItem Content="æ›´æ–°æ—¶é—´"></ComboBoxItem>
                        <ComboBoxItem Content="å‘è¡Œæ—¶é—´"></ComboBoxItem>
                        <ComboBoxItem Content="å­˜å‚¨å®¹é‡"></ComboBoxItem>
                    </ComboBox>
                </Grid>

                <Grid Grid.Row="1" Grid.Column="1">
                    <ScrollViewer  x:Name="ContentArea">
                        <ItemsRepeater  x:Name="GameList" ItemsSource="{x:Bind ViewModel.Games}" Margin="30" Loaded="GameList_Loaded" ElementPrepared="GamesItemsRepeater_ElementPrepared" ElementClearing="GamesItemsRepeater_ElementClearing">
                            <ItemsRepeater.Layout>
                                <tool:StaggeredLayout ColumnSpacing="15" RowSpacing="20" ItemsStretch="Fill"></tool:StaggeredLayout>
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="obj:Game">
                                    <Grid x:Name="ItemRoot" CornerRadius="8" MaxWidth="460"  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                                        <Grid x:Name="LoadingStateGrid">
                                            <lab:Shimmer IsActive="True" />
                                            <StackPanel VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="15,0,0,7" Spacing="5">
                                                <lab:Shimmer Height="18" Width="150" CornerRadius="4" />
                                                <lab:Shimmer Height="14" Width="250" CornerRadius="4" />
                                            </StackPanel>
                                        </Grid>
                                        <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                                            <Grid Width="460" Height="215">
                                                <Border x:Name="ImageContainer" Background="Transparent">
                                                    <Border.BackgroundTransition>
                                                        <BrushTransition/>
                                                    </Border.BackgroundTransition>
                                                </Border>

                                                <Rectangle  x:Name="GradientOverlay" Opacity="1" Visibility="Collapsed">
                                                    <Rectangle.Fill>
                                                        <LinearGradientBrush StartPoint="0.5,0.6" EndPoint="0.5,1">
                                                            <GradientStop Color="#00000000" Offset="0" />
                                                            <GradientStop Color="#55000000" Offset="1" />
                                                        </LinearGradientBrush>
                                                    </Rectangle.Fill>
                                                </Rectangle>
                                            </Grid>
                                        </Viewbox>
                                        <Grid x:Name="ErrorIndicator" Background="#80000000" Visibility="Collapsed">
                                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="4">
                                                <TextBlock Text="ðŸ˜±" FontSize="24" HorizontalAlignment="Center" />
                                                <TextBlock Text="å›¾ç‰‡åŠ è½½å¤±è´¥" Foreground="White" FontWeight="SemiBold" HorizontalAlignment="Center" />
                                            </StackPanel>
                                        </Grid>
                                        <blur:LinearGradientBlurPanel x:Name="EffectsBlurPanel" Height="60" MaxBlurAmount="5" EndPoint="0,0" HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Visibility="Collapsed" />

                                        <StackPanel x:Name="TextContentPanel" Opacity="0" Orientation="Horizontal" Margin="10,0,0,7" HorizontalAlignment="Left" VerticalAlignment="Bottom">
                                            <StackPanel Margin="5,0,0,0">
                                                <TextBlock Text="{x:Bind Name}" Opacity="0.9" FontSize="16" FontWeight="Bold" Foreground="White" HorizontalAlignment="Left" MaxWidth="200" TextTrimming="CharacterEllipsis" />
                                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0" Opacity="0.7">
                                                    <TextBlock Text="{x:Bind FirstTag}" Foreground="White" />
                                                    <TextBlock Margin="2,0,2,0" Text="â€¢" Foreground="White" Opacity="0.7" />
                                                    <TextBlock Text="ðŸ“" Foreground="White" />
                                                    <TextBlock Text="{x:Bind Size}" Foreground="White" />
                                                    <TextBlock Margin="2,0,2,0" Text="â€¢" Foreground="White" Opacity="0.7" />
                                                    <TextBlock Margin="0,0,0,0" Text="ðŸ’–" />
                                                    <TextBlock Text="{x:Bind Rank}" Foreground="White" />
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </ScrollViewer>
                    <Grid HorizontalAlignment="Left" VerticalAlignment="Stretch"  x:Name="Splitter">
                        <Rectangle Width="6"  Fill="Transparent" />
                        <Border Width="1"  HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>
                        <tool:PropertySizer x:Name="Sizer" Visibility="{x:Bind ViewModel.SplitterVisibility,Mode=OneWay}" HorizontalAlignment="Center" Binding="{x:Bind LeftColumn.MinWidth,Mode=TwoWay}" Minimum="280" Maximum="400"  IsFocusEngagementEnabled="False" IsTabStop="False" />
                        <base:VisibilityToggleButton Margin="0,0,-32,0" VerticalAlignment="Stretch" CornerRadius="0,6,6,0" AlwaysShowWhenCollapsed="True" IsEnabled="True" ShowTip="æŠ˜å " HideTip="å±•å¼€" Click="Btn_Click" />
                    </Grid>
                </Grid>
            </Grid>
        </SplitView.Content>
    </SplitView>
    
</Page>
